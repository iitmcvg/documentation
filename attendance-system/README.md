# Face Recognition

Computer Vision and1 Intelligence Group, IIT Madras

![avatar](media/avatar.png)

![example](media/example.jpg)

## To Do

* [] TF-Estimator based scalable train file.
* [x] SSDLite based detector
* [x] Mobilenet models for facenet
* [x] Angular, Focal and triplet losses.

## Dependencies

* Python 3.4+
* Tensorflow 1.6+
* Opencv 3.3.1+

## Usage

### Basic Usage

These set of instructions are for running the trained models.

#### Step 1: 

Install all required dependencies by running (does not include tensorflow, opencv3):
`pip install -r requirements.txt`

#### Step 2:

Place subjects as seperate folders under `media/train_image_classifier`.

There needs to be a minimum of two subjects.

Download the following models from here:

* [SSDLite mobilenet](https://drive.google.com/open?id=1k6ZXrgo4f0tU18tqlMLjN5tTb_6mwnsS): Place under detection/model/ssdlite_v2.pb [This can be customised]. 

* [Facenet Mobilenet](https://drive.google.com/open?id=1sBHIXC66tdKlj7pd9zxaEpxcGJmC5NA1): Place the frozen_inference.pb under detection/model/mobilenet_v2.pb [This can be customised]. 

#### Step 3:

Run
`python train_face_classify.py`

For non-standard flags, run as:

```
python train_face_classify.py [-h]
                              [--recognition_model {inception_resnet_v1,mobilenet_v2,inception_resnet_v2}]
                              [--detection_model {ssdlite_v2,ssd_mobilenet}]
                              [--trained_classifier TRAINED_CLASSIFIER]
                              [--classifier {SVM,KNN}]
                              [--embedding_size {128,512}]

optional arguments:
  -h, --help            show this help message and exit
  --recognition_model {inception_resnet_v1,mobilenet_v2,inception_resnet_v2}
  --detection_model {ssdlite_v2,ssd_mobilenet}
                        detection model to use
  --trained_classifier TRAINED_CLASSIFIER
                        trained classifier to use
  --classifier {SVM,KNN}
                        trained classifier to use
  --embedding_size {128,512}
                        Embedding Size
```

#### Step 4:

Run
```
python demo_face_recognition.py
```

## Model Zoo

All associated weight files may be found [here](
https://drive.google.com/drive/folders/1KIm781ON9FmifTjZ1BMUaWlSlzaZGqQj?usp=sharing) .

In specific, for the detector, we provide the following models:

Place detector model protobuf's (frozen graphs) under `detector/models/`.


Place recognition model protobuf's (frozen graphs) under `recognition/models/`.


## Pipeline
Image -> FaceDetection -> CroppedFace -> FaceRecognition -> Descriptor(128D) -> FaceClassifier -> Name

## FaceDetection(mobilenetSSD)
A mobilenet SSD(single shot multibox detector) based face detector with pretrained model provided.
Ref. [https://github.com/yeephycho/tensorflow-face-detection](https://github.com/yeephycho/tensorflow-face-detection)

## FaceRecognition(FaceNet)

TensorFlow implementation of the face recognizer described in the paper "FaceNet: A Unified Embedding for Face Recognition and Clustering". 
Ref. [https://github.com/davidsandberg/facenet](https://github.com/davidsandberg/facenet)

## FaceClassification(kNN, SVM)
Classify the features generated by FaceNet with kNN or SVM.

## Result
![Recognition result](./media/result.png)

